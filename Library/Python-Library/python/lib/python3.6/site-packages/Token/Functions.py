import base64
import json
import re

# Cognito Token Handler
# Base64 Decode for JWT Token
class B64:
    def decode_base64(data, altchars=b'+/'):
        data = re.sub(rb'[^a-zA-Z0-9%s]+' % altchars, b'', data) 
        missing_padding = len(data) % 4
        if missing_padding:
            data += b'='* (4 - missing_padding)
        return base64.b64decode(data, altchars)

# JWT Token Payload Decode
class TokenHandler:
    def __init__(self, token, uid):
        self.token = token
        self.uid = uid

    def DecodePayload(self):
        id_token = self.token
        dataset = id_token.split('.')
        payload = dataset[1].encode('ascii')
        storage = json.loads(B64.decode_base64(payload).decode('ascii'))
        return(storage[self.uid])

